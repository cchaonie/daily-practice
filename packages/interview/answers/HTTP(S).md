# HTTP

## TCP 连接

### 连接

1. A --> B syn
2. B --> A ack & syn
3. A --> B ack
   概述如下：
4. TCP 传输是分包传输，每个包都有自己的序列号，在建立连接的过程中就要把自己的初始序列号发送给对方
5. TCP 默认采取超时重传机制：即超过一定时间没有收到对方的确认信号，就重新发送一次未收到确认的包
6. 为了确保双方都**知道对方的初始序列号**并且**知道对方知道自己的序列号**后，方可以进行安全传输

### 断开

1. A --> B finish
2. B --> A ack
3. B --> A finish
4. A --> B ack

概述如下：

1. A 发送完数据后，发送 finish 信号给 B
2. B 接收到 finish 信息，返回 ack 确认消息
3. 因为此时 B 可能并没有传输完毕，只能在确认完毕之后，才能向 A 发送 finish 信号
4. A 向 B 发送确认信号，B 收到确认信号则关闭连接
5. A 等到足够长时间，确认此时没有收到 B 的超时重传信号，则关闭连接

## HTTPS 连接

建立 TCP 连接之后，

1. client --> server 客户端支持的加密协议
2. server --> client 服务端根据客户端传过来的加密协议，选择一个后，发送自己的公开信息及数字证书，数字证书来自第三方公正机构，包含数字签名和服务器公开信息及公钥。摘要通过特定 hash 算法生成，再使用公证机构的私钥对摘要进行加密，得到数字签名。
3. client --> server 客户端检查证书后，首先使用公证机构 CA 的公钥对数字签名解密得到摘要，再使用 hash 算法计算服务器公开信息的摘要，对比无误后确认服务器的信息。最后使用服务器的公钥加密后续使用的对称加密密钥，发送给到服务端
4. server --> ack 服务端保存 client 的密钥，返回 ack

之后所有的数据包都会使用对称加密传输。

## http2.0

1. 多路复用
2. 请求优先级
3. 头部压缩（header，cookie）
4. 服务端推送（页面依赖资源可以由服务端主动推送）
5. 二进制分帧层：从基于文本变成基于二进制格式的编码

## 区别
Http1.0 每一次请求都必须创建一个新的TCP连接；
Http1.1 下一次请求可以沿用上一次请求的TCP连接，但是请求之间是串行的，必须等上一个请求结束后，下一个请求才能发起；
Http2.0 可以将多个请求同时在一个TCP连接中发出。