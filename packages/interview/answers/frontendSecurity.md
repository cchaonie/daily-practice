# 前端安全

## XSS 跨站脚本

### 分类

| 类型   | 特点                                                                                             |
| ------ | ------------------------------------------------------------------------------------------------ |
| 存储型 | 在本站中将恶意代码提交后存储到服务器，后续请求的页面会包含恶意代码，浏览器渲染页面后执行恶意代码 |
| 反射型 | 构造恶意 URL，服务器生成的页面中包含恶意 URL 中的代码，浏览器渲染页面后执行恶意代码              |
| DOM型 | 构造恶意 URL，前端 js 会在使用到 URL 中的数据，从而执行恶意代码                                  |

前两者属于服务器端的安全漏洞，即服务端在ssr的时候没有做处理；
后者属于前端漏洞，在使用数据前没有做合适的检查

### 防范
1. 转义：在任何将用户数据填充到页面之前，都需要做合适的转义
2. 前端渲染：使用标准DOMAPI生成页面内容，可以减少插入HTML的风险
3. 对于DOM型，前端需要注意谨慎使用：
  1. `innerHTML` `outerHTML`
  2. react的`dangerouslySetInnerHTML`
  3. 内联事件监听器
  4. a标签的href、location
  5. setTimout setInterval等函数
4. Content Security Policy
5. cookie的http-only
6. 验证码等

## CSRF 跨站请求伪造
跨站请求伪造的发生原因在于：
1. 请求发送到与cookie的同源站点，cookie会被自动带上
2. cookie被用作识别用户身份的唯一手段

攻击一般流程如下：
1. 用户登录目标网站后，cookie存储到浏览器
2. 用户进入第三网网站，第三方网站向目标网站发送请求，此时会带上用户的cookie信息
3. 目标网站服务器收到请求后，仅验证了cookie，从而执行了恶意操作

## 防范
1. 一般csrf都是跨站请求，因此可以通过识别跨站请求来识别恶意攻击。如使用`Origin` `referer`的头部
2. 不完全依赖cookie做用户认证
  1. 可替代方案是使用随机token。服务端下发token，后续请求需要带上token才能成功交互
  2. 双重cookie。在请求头中也要带上cookie，因为csrf一般无法直接读取cookie